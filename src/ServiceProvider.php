<?php

namespace Infofactory\BardMultipromptAi;

use Statamic\Facades\CP\Nav;
use Statamic\Facades\Permission;
use Statamic\Providers\AddonServiceProvider;

class ServiceProvider extends AddonServiceProvider
{
    protected $vite = [
        'input' => [
            'resources/js/addon.js',
        ],
        'publicDirectory' => 'resources/dist',
    ];

    protected $routes = [
        'cp' => __DIR__.'/routes/cp.php',
    ];

    public function bootAddon()
    {
        // Register views
        $this->loadViewsFrom(__DIR__.'/../resources/views', 'bard-multiprompt-ai');

        // Register navigation
        Nav::extend(function ($nav) {
            $nav->content(__('bard-multiprompt-ai::cp.title'))
                ->section('Tools')
                ->icon('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="#000000" id="Magic-Wand-Thin--Streamline-Phosphor-Thin"><desc>Magic Wand Thin Streamline Icon: https://streamlinehq.com</desc><path d="M15.84 9.8090625c0 0.16651875 -0.13499375 0.30150625 -0.3015125 0.30150625H14.0309375V11.618125c0 0.2321 -0.25125625 0.3771625 -0.4522625 0.2611125 -0.0932875 -0.05385625 -0.15075625 -0.15339375 -0.15075625 -0.2611125v-1.50755625h-1.50755c-0.23210625 0 -0.37716875 -0.25125625 -0.26111875 -0.4522625 0.0538625 -0.0932875 0.1534 -0.15075625 0.26111875 -0.15075625h1.50755V8c0 -0.23210625 0.25125625 -0.37716875 0.4522625 -0.26111875 0.0932875 0.0538625 0.15075625 0.1534 0.15075625 0.26111875v1.50755h1.50755c0.16651875 0 0.3015125 0.13499375 0.3015125 0.3015125ZM1.66901875 3.47734375h1.50755v1.50755625c0 0.2321 0.2512625 0.3771625 0.45226875 0.2611125 0.0932875 -0.05385625 0.15075 -0.15339375 0.15075 -0.2611125V3.47734375h1.50755625c0.2321 0 0.3771625 -0.25125625 0.2611125 -0.4522625 -0.05385625 -0.09328125 -0.1534 -0.15075 -0.2611125 -0.15075625H3.7795875V1.366775c0 -0.23210625 -0.25125625 -0.37716875 -0.4522625 -0.26111875 -0.0932875 0.0538625 -0.15075625 0.1534 -0.15075625 0.26111875v1.50755H1.66901875c-0.2321 0.0000125 -0.37716875 0.251275 -0.26110625 0.452275 0.05385625 0.09328125 0.15339375 0.15074375 0.26110625 0.15074375Zm9.648325 9.64833125h-0.904525v-0.90453125c0 -0.2321 -0.2512625 -0.37716875 -0.45226875 -0.2611125 -0.0932875 0.05385625 -0.15075625 0.15339375 -0.15075625 0.2611125v0.90453125h-0.90453125c-0.2321 0 -0.3771625 0.25125625 -0.2611125 0.4522625 0.05385625 0.0932875 0.15339375 0.15075625 0.2611125 0.15075625h0.90453125v0.90453125c0 0.23210625 0.2512625 0.37716875 0.45226875 0.26111875 0.0932875 -0.0538625 0.15075625 -0.1534 0.15075625 -0.26111875v-0.90453125h0.904525c0.23210625 0 0.37716875 -0.25125625 0.26111875 -0.4522625 -0.0538625 -0.0932875 -0.15339375 -0.15075625 -0.26111875 -0.15075625Zm2.44826875 -8.95711875L3.2647625 14.6701625c-0.35349375 0.35471875 -0.927925 0.35471875 -1.28141875 0l-1.5573 -1.5595625c-0.354725 -0.35349375 -0.354725 -0.927925 0 -1.28141875L10.92764375 1.3298375c0.35349375 -0.35471875 0.927925 -0.35471875 1.28141875 0l1.55655 1.5595625c0.3532125 0.3532375 0.3532125 0.925925 0 1.27915625Zm-3.477925 2.6254 -1.98544375 -1.98544375 -7.4495625 7.44956875c-0.11740625 0.1176875 -0.11740625 0.30819375 0 0.42588125l1.55880625 1.5595625c0.117775 0.11790625 0.3088625 0.11790625 0.4266375 0Zm3.0520375 -3.47791875 -1.5595625 -1.5595625c-0.117775 -0.11790625 -0.3088625 -0.11790625 -0.4266375 0L8.728125 4.381875l1.9862 1.98545 2.6254 -2.62540625c0.11740625 -0.1176875 0.11740625 -0.30819375 0 -0.42588125Z" stroke-width="0.0625"></path></svg>')
                ->route('bard-multiprompt-ai.config')
                ->can('manage bard-multiprompt-ai config');
        });

        // Register permissions
        Permission::register('manage bard-multiprompt-ai config')
            ->label('Manage Bard AI Configs');

        // Register configs
        $this->mergeConfigFrom(
            __DIR__.'/../config/bard-multiprompt-ai.php', 'bard-multiprompt-ai'
        );

        if (!file_exists(config_path('bard-multiprompt-ai.php'))) {
            $this->publishes([
                __DIR__.'/../config/bard-multiprompt-ai.php' => config_path('bard-multiprompt-ai.php'),
            ], 'bard-multiprompt-ai');
        }

        // Action routes
        $this->registerActionRoutes(__DIR__.'/routes/actions.php');
    }
}
